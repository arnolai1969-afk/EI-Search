<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EI Compendex Journal Search System</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (cdnjs) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            overscroll-behavior-y: contain; 
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #c1c1c1; 
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8; 
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // ==========================================================================================
        // [CONFIGURATION]
        const FILE_PREFIX_TARGET = "CPXSourceList_"; 
        // ==========================================================================================

        // Icons
        const IconBase = ({ children, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Database = (props) => <IconBase {...props}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></IconBase>;
        const Search = (props) => <IconBase {...props}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconBase>;
        const RefreshCw = (props) => <IconBase {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></IconBase>;
        const Printer = (props) => <IconBase {...props}><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></IconBase>;
        const Loader = (props) => <IconBase {...props}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></IconBase>;
        const AlertTriangle = (props) => <IconBase {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></IconBase>;
        const Cloud = (props) => <IconBase {...props}><path d="M17.5 19c0-1.7-1.3-3-3-3h-1.1c-.1-2.9-2.4-5.2-5.3-5.2-1.8 0-3.4.9-4.3 2.3-.3-.1-.7-.1-1-.1C4.7 13 3 14.7 3 16.5S4.7 20 6.8 20h10.7c1.7 0 3-1.3 3-3z"/></IconBase>;
        const Upload = (props) => <IconBase {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></IconBase>;
        const Server = (props) => <IconBase {...props}><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></IconBase>;

        // --- NEW ARCHITECTURE: Worker holds data, Main thread only receives results ---
        const workerCode = `
        importScripts('https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js');

        // GLOBAL STORE IN WORKER
        let GLOBAL_DB = [];

        const sanitize = (str) => {
            if (!str) return '';
            return String(str).replace(/[\\u00A0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]/g, ' ').replace(/\\s+/g, ' ').trim();
        };

        self.onmessage = function(e) {
            const { type, data, query } = e.data;

            if (type === 'PARSE') {
                try {
                    const workbook = XLSX.read(data, { type: 'array' });
                    GLOBAL_DB = []; // Reset DB
                    let uniqueIdCounter = 0;

                    workbook.SheetNames.forEach(sheetName => {
                        const worksheet = workbook.Sheets[sheetName];
                        const rawData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        let headerIdx = -1, colMap = {};
                        
                        // Detect headers
                        for (let i = 0; i < Math.min(rawData.length, 100); i++) {
                            const row = (rawData[i] || []).map(c => sanitize(c).toLowerCase());
                            if (row.some(cell => cell.includes('source title') || cell.includes('journal name') || cell === 'issn')) {
                                headerIdx = i;
                                rawData[headerIdx].forEach((cell, cellIdx) => {
                                    const c = sanitize(cell).toLowerCase();
                                    if (c.includes('source title') || c.includes('journal name')) colMap.title = cellIdx;
                                    if (c === 'issn' || c.includes('print issn')) colMap.issn = cellIdx;
                                    if (c.includes('online issn') || c === 'eissn') colMap.eissn = cellIdx;
                                    if (c.includes('publisher')) colMap.publisher = cellIdx;
                                    if (c.includes('country') || c.includes('location')) colMap.country = cellIdx;
                                    if (c.includes('language') || c === '语言') colMap.lang = cellIdx;
                                });
                                break;
                            }
                        }

                        if (headerIdx !== -1) {
                            const rows = rawData.slice(headerIdx + 1);
                            const getVal = (row, key) => colMap[key] !== undefined ? sanitize(row[colMap[key]] || '') : '';
                            
                            // Parse and Store in Worker Memory ONLY
                            const sheetRows = rows.map(r => {
                                let title = getVal(r, 'title');
                                if (!title) return null;
                                return {
                                    id: \`row-\${uniqueIdCounter++}\`,
                                    title,
                                    issn: getVal(r, 'issn') || '-',
                                    eissn: getVal(r, 'eissn') || '-',
                                    publisher: getVal(r, 'publisher') || '-',
                                    country: getVal(r, 'country') || '-',
                                    language: getVal(r, 'lang') || '-'
                                };
                            }).filter(r => r !== null);
                            
                            GLOBAL_DB.push(...sheetRows);
                        }
                    });

                    // Notify main thread that parsing is done, BUT DO NOT SEND DATA yet
                    self.postMessage({ type: 'INIT_COMPLETE', total: GLOBAL_DB.length });

                } catch (err) {
                    self.postMessage({ type: 'ERROR', error: err.message });
                }
            }

            if (type === 'SEARCH') {
                if (!GLOBAL_DB.length) {
                    self.postMessage({ type: 'SEARCH_RESULTS', rows: [], totalMatches: 0, isTruncated: false });
                    return;
                }

                let results = GLOBAL_DB;
                const safeLimit = 3000; // Mobile Safety Limit

                if (query && query.trim()) {
                    const q = query.toLowerCase().trim();
                    results = GLOBAL_DB.filter(item => item.title && item.title.toLowerCase().includes(q));
                }

                const totalMatches = results.length;
                const isTruncated = totalMatches > safeLimit;
                
                // Only send the sliced results to Main Thread to prevent memory crash
                const rowsToSend = isTruncated ? results.slice(0, safeLimit) : results;

                self.postMessage({ 
                    type: 'SEARCH_RESULTS', 
                    rows: rowsToSend, 
                    totalMatches: totalMatches,
                    isTruncated: isTruncated 
                });
            }
        };
        `;

        const App = () => {
            // "unifiedData" is REMOVED to save memory. Main thread only holds "displayData".
            const [displayData, setDisplayData] = useState([]);
            const [inputValue, setInputValue] = useState('');
            const [debouncedTerm, setDebouncedTerm] = useState('');
            
            const [isParsing, setIsParsing] = useState(false); // Parsing Excel
            const [isSearching, setIsSearching] = useState(false); // Searching in Worker
            const [loadingStatus, setLoadingStatus] = useState('');
            const [errorMsg, setErrorMsg] = useState(null);
            
            const [stats, setStats] = useState({ total: 0, lastUpdated: '-', source: 'INIT', filename: '' });
            const [isFileLoaded, setIsFileLoaded] = useState(false);
            const [isTruncated, setIsTruncated] = useState(false); // State for truncation warning
            
            const [isPrinting, setIsPrinting] = useState(false);
            const [isLocalMode, setIsLocalMode] = useState(false);
            
            const workerRef = useRef(null);
            const hasFetched = useRef(false);

            const formatDatabaseVersion = (filename) => {
                if (!filename) return "N/A";
                const match = filename.match(/(\d{6})/);
                if (match) {
                    const dateStr = match[1];
                    return `${dateStr.substring(0, 2)}/${dateStr.substring(2, 6)}`;
                }
                return filename;
            };

            useEffect(() => {
                const blob = new Blob([workerCode], { type: 'application/javascript' });
                workerRef.current = new Worker(URL.createObjectURL(blob));

                workerRef.current.onmessage = (e) => {
                    const { type, total, rows, error, totalMatches, isTruncated: truncated } = e.data;

                    if (type === 'INIT_COMPLETE') {
                        // Data loaded in Worker. Main thread doesn't hold data.
                        setStats(prev => ({ ...prev, total: total, lastUpdated: new Date().toLocaleDateString() }));
                        setIsFileLoaded(true);
                        setIsParsing(false);
                        setLoadingStatus('');
                        
                        // Trigger initial empty search to fill table (capped)
                        workerRef.current.postMessage({ type: 'SEARCH', query: '' });
                    }
                    else if (type === 'SEARCH_RESULTS') {
                        setDisplayData(rows);
                        setIsTruncated(truncated);
                        setIsSearching(false);
                    }
                    else if (type === 'ERROR') {
                        setErrorMsg({ text: `Parsing Failed: ${String(error)}`, code: "WORKER_ERR" });
                        setIsParsing(false);
                        setLoadingStatus('');
                    }
                };
                return () => workerRef.current.terminate();
            }, []);

            useEffect(() => {
                if (hasFetched.current) return;
                if (window.location.protocol === 'file:') {
                    hasFetched.current = true;
                    setIsLocalMode(true);
                    setStats(prev => ({ ...prev, source: 'LOCAL' }));
                } else {
                    hasFetched.current = true;
                    setIsLocalMode(false);
                    setStats(prev => ({ ...prev, source: 'WEB' }));
                    handleGitHubAutoFetch();
                }
            }, []);

            // Debounce Input and trigger SEARCH on Worker
            useEffect(() => {
                const timer = setTimeout(() => {
                    if (isFileLoaded) {
                        setIsSearching(true);
                        workerRef.current.postMessage({ type: 'SEARCH', query: inputValue });
                    }
                }, 300);
                return () => clearTimeout(timer);
            }, [inputValue, isFileLoaded]);

            const handleGitHubAutoFetch = async () => {
                setIsParsing(true);
                setLoadingStatus('Scanning GitHub directory...');
                setErrorMsg(null);
                try {
                    const hostname = window.location.hostname;
                    const pathParts = window.location.pathname.split('/').filter(p => p);
                    if (!hostname.includes('github.io')) throw new Error("Not GitHub Pages.");
                    const username = hostname.split('.')[0];
                    const repoName = pathParts[0];
                    if (!username || !repoName) throw new Error("Repo info missing.");

                    const apiResponse = await fetch(`https://api.github.com/repos/${username}/${repoName}/contents/`);
                    if (!apiResponse.ok) throw new Error("API Error or Rate Limit.");
                    const files = await apiResponse.json();

                    const targetFiles = files.filter(f => f.type === 'file' && f.name.startsWith(FILE_PREFIX_TARGET) && (f.name.endsWith('.xlsx') || f.name.endsWith('.xls')));
                    if (targetFiles.length === 0) throw new Error("No database files found.");

                    targetFiles.sort((a, b) => {
                        const getDateNum = (name) => {
                            const match = name.match(/(\d{6})/);
                            if (!match) return 0;
                            const ds = match[1];
                            return parseInt(ds.substring(2, 6) + ds.substring(0, 2));
                        };
                        return getDateNum(b.name) - getDateNum(a.name);
                    });

                    const newestFile = targetFiles[0];
                    setStats(prev => ({ ...prev, filename: newestFile.name }));
                    setLoadingStatus(`Downloading: ${newestFile.name}...`);
                    
                    const timestamp = new Date().getTime(); // Cache busting
                    const fileResponse = await fetch(`./${newestFile.name}?t=${timestamp}`);
                    if (!fileResponse.ok) throw new Error("Download failed.");
                    const buffer = await fileResponse.arrayBuffer();
                    
                    setLoadingStatus('Parsing data (Worker)...');
                    // Send buffer to worker. Worker KEEPS it.
                    workerRef.current.postMessage({ type: 'PARSE', data: new Uint8Array(buffer) });

                } catch (error) {
                    console.warn(error);
                    setErrorMsg({ text: error.message, code: "FETCH_ERR" });
                    setIsParsing(false);
                }
            };

            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                setIsParsing(true);
                setLoadingStatus('Reading file...');
                setErrorMsg(null);
                const reader = new FileReader();
                reader.onload = (event) => {
                    setLoadingStatus('Processing...');
                    setStats(prev => ({ ...prev, filename: file.name, source: 'MANUAL' }));
                    workerRef.current.postMessage({ type: 'PARSE', data: new Uint8Array(event.target.result) });
                };
                reader.readAsArrayBuffer(file);
            };

            const handlePrint = () => {
                setIsPrinting(true);
                setTimeout(() => { window.print(); setIsPrinting(false); }, 500);
            };

            return (
                <div className="flex flex-col h-screen bg-[#f8f9fa] text-gray-800 font-sans select-none overflow-hidden print:h-auto print:overflow-visible print:bg-white">
                    <style>{`
                        @media print {
                            @page { size: landscape; margin: 5mm; }
                            body { -webkit-print-color-adjust: exact; background-color: white !important; }
                            .no-print { display: none !important; }
                            .print-visible { overflow: visible !important; height: auto !important; display: block !important; }
                            .virtual-container { position: static !important; height: auto !important; overflow: visible !important; }
                            .print-row { page-break-inside: avoid; display: flex !important; align-items: flex-start !important; border-bottom: 1px solid #ddd; padding: 10px 0; }
                            .print-row div { white-space: normal !important; overflow: visible !important; text-overflow: clip !important; }
                            .col-title { width: 30% !important; }
                            .col-issn { width: 12% !important; }
                            .col-eissn { width: 12% !important; }
                            .col-pub { width: 20% !important; }
                            .col-country { width: 13% !important; }
                            .col-lang { width: 13% !important; }
                        }
                    `}</style>

                    {/* Header */}
                    <header className="bg-white border-b border-gray-200 px-4 py-3 flex flex-wrap items-center justify-between shadow-sm shrink-0 gap-3 no-print z-10">
                        <div className="flex items-center gap-3 shrink-0 mr-auto">
                            <div className={`p-2 rounded-lg ${isLocalMode ? 'bg-orange-500' : 'bg-slate-800'}`}>
                                <Database className="text-white w-5 h-5" />
                            </div>
                            <div>
                                <h1 className="text-lg font-bold text-slate-900 leading-tight">EI Compendex Search</h1>
                                <div className="flex flex-wrap items-center gap-2 text-[11px] text-slate-500">
                                    <span className={`font-bold ${isLocalMode ? 'text-orange-600' : 'text-emerald-600'}`}>
                                        {isLocalMode ? "Local Mode" : "Cloud Mode"}
                                    </span>
                                    <span className="hidden sm:inline">|</span>
                                    <span className="font-bold text-slate-700">Ver: {formatDatabaseVersion(stats.filename)}</span>
                                </div>
                            </div>
                        </div>

                        <div className="relative flex-grow w-full md:w-auto order-last md:order-none mt-2 md:mt-0">
                            <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
                            <input
                                type="text"
                                placeholder={isFileLoaded ? "Filter Journal, ISSN, Publisher..." : "Loading database..."}
                                className="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg bg-white focus:ring-2 focus:ring-slate-800 focus:border-slate-800 outline-none text-sm transition-all shadow-sm font-medium"
                                value={inputValue}
                                onChange={(e) => setInputValue(e.target.value)}
                                disabled={!isFileLoaded}
                            />
                            { (inputValue !== debouncedTerm || isSearching) && (
                                <div className="absolute right-3 top-1/2 -translate-y-1/2">
                                    <RefreshCw className="w-3 h-3 text-slate-400 animate-spin" />
                                </div>
                            )}
                        </div>

                        <div className="flex items-center gap-2 shrink-0">
                            {isFileLoaded && (
                                <button onClick={handlePrint} className="flex items-center gap-2 px-3 py-2 bg-white text-slate-700 border border-slate-300 rounded-lg font-bold hover:bg-slate-50 transition-all text-xs shadow-sm whitespace-nowrap">
                                    {isPrinting ? <Loader className="w-4 h-4 animate-spin" /> : <Printer className="w-4 h-4" />} <span className="hidden sm:inline">Print</span>
                                </button>
                            )}
                        </div>
                    </header>

                    <main className="flex-1 overflow-hidden bg-white p-0 relative print-visible flex flex-col">
                        <div className="hidden print:block p-4 border-b-2 border-black mb-4">
                            <h1 className="text-2xl font-bold">Search Report</h1>
                            <div className="flex justify-between mt-2 text-sm">
                                <span>Keywords: {inputValue || "(Show All)"}</span>
                                <span>Total Matches: {displayData.length} (Database: {stats.total.toLocaleString()})</span>
                                <span>Database: {formatDatabaseVersion(stats.filename)}</span>
                            </div>
                        </div>

                        {isParsing && (
                            <div className="flex flex-col items-center justify-center h-full text-slate-500 bg-white/95 z-20 absolute inset-0 no-print">
                                <RefreshCw className="w-10 h-10 mb-4 animate-spin text-blue-600" />
                                <p className="text-base font-bold text-slate-700">{loadingStatus}</p>
                            </div>
                        )}

                        {!isFileLoaded && !isParsing && (
                            <div className="flex flex-col items-center justify-center h-full text-slate-400 bg-slate-50 no-print px-4">
                                <div className="bg-white p-6 rounded-xl shadow-sm mb-6 max-w-md w-full text-center border border-slate-200">
                                    {errorMsg ? <div className="text-amber-500 mb-3 flex justify-center"><AlertTriangle className="w-10 h-10" /></div> : <div className="text-slate-300 mb-3 flex justify-center"><Upload className="w-10 h-10" /></div>}
                                    <h2 className="text-lg font-bold text-slate-800 mb-2">{errorMsg ? "Auto-load incomplete" : (isLocalMode ? "Upload Database" : "Initializing...")}</h2>
                                    <p className="text-xs text-slate-500 mb-5 leading-relaxed">
                                        {errorMsg ? <span>{errorMsg.text}<br/>Please try manual upload.</span> : (isLocalMode ? "Browser security prevents auto-loading local files." : "Checking GitHub directory...")}
                                    </p>
                                    <div className="relative overflow-hidden group inline-block w-full">
                                        <input type="file" accept=".xlsx, .xls" onChange={handleFileUpload} className="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />
                                        <button className="flex items-center justify-center gap-2 w-full px-4 py-2.5 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 transition-colors shadow-md font-bold">
                                            <Upload className="w-4 h-4" /> Upload Excel Manually
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* TRUNCATION WARNING */}
                        {isTruncated && isFileLoaded && (
                            <div className="bg-amber-50 border-b border-amber-200 text-amber-800 px-4 py-2 text-xs flex items-center justify-center gap-2 no-print">
                                <AlertTriangle className="w-3 h-3" />
                                <span>Displaying top 3,000 results. Please enter keywords to narrow down.</span>
                            </div>
                        )}

                        {isFileLoaded && (
                            <VirtualTable data={displayData} isPrinting={isPrinting} />
                        )}
                        
                        {/* Footer Info Bar */}
                        {isFileLoaded && (
                            <div className="bg-slate-50 text-slate-400 text-[10px] py-2 px-4 border-t border-slate-200 text-center shrink-0 print:hidden">
                                Showing {displayData.length.toLocaleString()} {isTruncated ? '(Truncated)' : ''} / Database Total {stats.total.toLocaleString()} records
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const VirtualTable = ({ data, isPrinting }) => {
            const parentRef = useRef();
            const [scrollTop, setScrollTop] = useState(0);
            const [containerHeight, setContainerHeight] = useState(800);
            const rowHeight = 80; 
            const totalHeight = data.length * rowHeight;

            useEffect(() => {
                if (parentRef.current) {
                    setContainerHeight(parentRef.current.clientHeight);
                    const handleScroll = (e) => setScrollTop(e.target.scrollTop);
                    const parent = parentRef.current;
                    parent.addEventListener('scroll', handleScroll);
                    const handleResize = () => setContainerHeight(parent.clientHeight);
                    window.addEventListener('resize', handleResize);
                    return () => {
                        parent.removeEventListener('scroll', handleScroll);
                        window.removeEventListener('resize', handleResize);
                    };
                }
            }, []);

            let visibleData = data;
            let startSpacerHeight = 0;
            
            if (!isPrinting && data.length > 50) {
                const startIndex = Math.floor(scrollTop / rowHeight);
                const visibleNodeCount = Math.ceil(containerHeight / rowHeight);
                const start = Math.max(0, startIndex - 5);
                const end = Math.min(data.length, startIndex + visibleNodeCount + 5);
                visibleData = data.slice(start, end);
                startSpacerHeight = start * rowHeight;
            }

            const colWidths = {
                title: "min-w-[30%] max-w-[30%] shrink-0",    
                issn: "min-w-[120px] max-w-[120px] shrink-0",
                eissn: "min-w-[120px] max-w-[120px] shrink-0",
                pub: "min-w-[20%] max-w-[20%] shrink-0",       
                country: "min-w-[120px] max-w-[120px] shrink-0",
                lang: "min-w-[120px] max-w-[120px] shrink-0"
            };
            
            const minTableWidth = "min-w-[1000px]";

            return (
                <div className="flex flex-col h-full print:h-auto overflow-hidden relative">
                    <div ref={parentRef} className={`flex-1 overflow-auto custom-scrollbar print:overflow-visible ${isPrinting ? '' : 'w-full'}`}>
                        <div className={`${isPrinting ? '' : minTableWidth} ${isPrinting ? 'h-auto' : ''}`} style={{ height: isPrinting ? 'auto' : totalHeight + 40 }}>
                            
                            <div className={`sticky top-0 z-10 bg-slate-100 border-b border-slate-300 flex text-[11px] font-bold text-slate-700 uppercase tracking-wider shadow-sm print:hidden ${minTableWidth}`}>
                                <div className={`px-4 py-3 border-r border-slate-200 ${colWidths.title} w-[30%]`}>Source Title</div>
                                <div className={`px-3 py-3 border-r border-slate-200 text-center ${colWidths.issn}`}>ISSN</div>
                                <div className={`px-3 py-3 border-r border-slate-200 text-center ${colWidths.eissn}`}>E-ISSN</div>
                                <div className={`px-4 py-3 border-r border-slate-200 ${colWidths.pub} w-[20%]`}>Publisher</div>
                                <div className={`px-3 py-3 border-r border-slate-200 ${colWidths.country}`}>Country</div>
                                <div className={`px-3 py-3 ${colWidths.lang}`}>Language</div>
                            </div>
                            
                            <div className="hidden print:flex text-[10px] font-bold border-b border-black mb-2">
                                <div className="col-title">Source Title</div>
                                <div className="col-issn text-center">ISSN</div>
                                <div className="col-eissn text-center">E-ISSN</div>
                                <div className="col-pub">Publisher</div>
                                <div className="col-country">Country</div>
                                <div className="col-lang">Language</div>
                            </div>

                            <div style={{ height: isPrinting ? 0 : startSpacerHeight }} className="print:hidden"></div>
                            
                            {visibleData.length > 0 ? (
                                visibleData.map((item) => (
                                    <div 
                                        key={item.id} 
                                        className={`flex text-sm hover:bg-blue-50 transition-colors group border-b border-slate-100 items-start py-2 ${isPrinting ? 'print-row' : minTableWidth}`}
                                        style={{ height: isPrinting ? 'auto' : 'auto', minHeight: isPrinting ? 0 : rowHeight }} 
                                    >
                                        <div className={`px-4 leading-snug whitespace-normal break-words border-r border-transparent group-hover:border-slate-200 text-slate-700 font-medium ${colWidths.title} w-[30%] print:col-title`} title={item.title}>
                                            {item.title}
                                        </div>
                                        <div className={`px-3 font-mono text-slate-500 text-[13px] text-center leading-snug border-r border-transparent group-hover:border-slate-200 ${colWidths.issn} print:col-issn`}>
                                            {item.issn}
                                        </div>
                                        <div className={`px-3 font-mono text-slate-500 text-[13px] text-center leading-snug border-r border-transparent group-hover:border-slate-200 ${colWidths.eissn} print:col-eissn`}>
                                            {item.eissn}
                                        </div>
                                        <div className={`px-4 text-slate-600 text-[13px] leading-snug whitespace-normal break-words border-r border-transparent group-hover:border-slate-200 ${colWidths.pub} w-[20%] print:col-pub`}>
                                            {item.publisher}
                                        </div>
                                        <div className={`px-3 text-slate-600 text-[13px] leading-snug whitespace-normal border-r border-transparent group-hover:border-slate-200 ${colWidths.country} print:col-country`}>
                                            {item.country}
                                        </div>
                                        <div className={`px-3 text-[12px] text-slate-500 leading-snug ${colWidths.lang} print:col-lang`}>
                                            {item.language}
                                        </div>
                                    </div>
                                ))
                            ) : (
                                <div className="py-20 text-center w-full absolute left-0">
                                    <p className="text-slate-500 text-sm font-medium">No matching records found.</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
